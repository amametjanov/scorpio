<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>PIO: pio_rearrange.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PIO
   &#160;<span id="projectnumber">2.0.28</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>PIO&#160;User's&#160;Guide</span></a></li>
      <li><a href="annotated.html"><span>Appendix</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_43d99ce78fde0129422a9159c5186d57.html">ParallelIO</a></li><li class="navelem"><a class="el" href="dir_141a8219d9000c6e4137175db07b6601.html">src</a></li><li class="navelem"><a class="el" href="dir_f00dc8b6574f3e86f0c5dc7c00a526e4.html">clib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pio_rearrange.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Code to map IO to model decomposition.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;config.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="pio_8h_source.html">pio.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="pio__internal_8h_source.html">pio_internal.h</a>&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pio_rearrange.c:</div>
<div class="dyncontent">
<div class="center"><img src="pio__rearrange_8c__incl.png" border="0" usemap="#pio__rearrange_8c" alt=""/></div>
<map name="pio__rearrange_8c" id="pio__rearrange_8c">
<area shape="rect" id="node3" href="pio_8h.html" title="Public headers for the PIO C interface. " alt="" coords="191,155,241,181"/><area shape="rect" id="node9" href="pio__internal_8h.html" title="Private headers and defines for the PIO C interface. " alt="" coords="311,80,409,107"/><area shape="rect" id="node10" href="bget_8h_source.html" title="bget.h" alt="" coords="265,155,323,181"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aae7757932984cb74424b447b9cf4955e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#aae7757932984cb74424b447b9cf4955e">init_rearr_opts</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *iosys)</td></tr>
<tr class="memdesc:aae7757932984cb74424b447b9cf4955e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal library util function to initialize rearranger options.  <a href="#aae7757932984cb74424b447b9cf4955e">More...</a><br/></td></tr>
<tr class="separator:aae7757932984cb74424b447b9cf4955e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26b1b0f5f1f4f977aa5e9d9d0fb09ce1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a26b1b0f5f1f4f977aa5e9d9d0fb09ce1">idx_to_dim_list</a> (int ndims, const int *gdimlen, PIO_Offset idx, PIO_Offset *dim_list)</td></tr>
<tr class="memdesc:a26b1b0f5f1f4f977aa5e9d9d0fb09ce1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a 1-D index into a coordinate value in an arbitrary dimension space.  <a href="#a26b1b0f5f1f4f977aa5e9d9d0fb09ce1">More...</a><br/></td></tr>
<tr class="separator:a26b1b0f5f1f4f977aa5e9d9d0fb09ce1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34894ab4fab60701301c8d3c67219c20"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a34894ab4fab60701301c8d3c67219c20">expand_region</a> (int dim, const int *gdimlen, int maplen, const PIO_Offset *map, int region_size, int region_stride, const int *max_size, PIO_Offset *count)</td></tr>
<tr class="memdesc:a34894ab4fab60701301c8d3c67219c20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Expand a region along dimension dim, by incrementing count[i] as much as possible, consistent with the map.  <a href="#a34894ab4fab60701301c8d3c67219c20">More...</a><br/></td></tr>
<tr class="separator:a34894ab4fab60701301c8d3c67219c20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1618d520a976b72b2e617794e67a0a96"><td class="memItemLeft" align="right" valign="top">PIO_Offset&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a1618d520a976b72b2e617794e67a0a96">find_region</a> (int ndims, const int *gdimlen, int maplen, const PIO_Offset *map, PIO_Offset *start, PIO_Offset *count)</td></tr>
<tr class="memdesc:a1618d520a976b72b2e617794e67a0a96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set start and count so that they describe the first region in map.  <a href="#a1618d520a976b72b2e617794e67a0a96">More...</a><br/></td></tr>
<tr class="separator:a1618d520a976b72b2e617794e67a0a96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a048b73236020ba121556fa86557a050d"><td class="memItemLeft" align="right" valign="top">PIO_Offset&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a048b73236020ba121556fa86557a050d">coord_to_lindex</a> (int ndims, const PIO_Offset *lcoord, const PIO_Offset *count)</td></tr>
<tr class="memdesc:a048b73236020ba121556fa86557a050d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a global coordinate value into a local array index.  <a href="#a048b73236020ba121556fa86557a050d">More...</a><br/></td></tr>
<tr class="separator:a048b73236020ba121556fa86557a050d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7be19ba8290fabfe5d713784109a13cc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a7be19ba8290fabfe5d713784109a13cc">compute_maxIObuffersize</a> (MPI_Comm io_comm, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="memdesc:a7be19ba8290fabfe5d713784109a13cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute the max io buffer size needed for an iodesc.  <a href="#a7be19ba8290fabfe5d713784109a13cc">More...</a><br/></td></tr>
<tr class="separator:a7be19ba8290fabfe5d713784109a13cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c21c922692dea1b9f7a2a889b6e790c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a5c21c922692dea1b9f7a2a889b6e790c">create_mpi_datatypes</a> (MPI_Datatype mpitype, int msgcnt, const PIO_Offset *mindex, const int *mcount, int *mfrom, MPI_Datatype *mtype)</td></tr>
<tr class="memdesc:a5c21c922692dea1b9f7a2a889b6e790c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the derived MPI datatypes used for comp2io and io2comp transfers.  <a href="#a5c21c922692dea1b9f7a2a889b6e790c">More...</a><br/></td></tr>
<tr class="separator:a5c21c922692dea1b9f7a2a889b6e790c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac50e05927ec724b673ceb602b1c0d483"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#ac50e05927ec724b673ceb602b1c0d483">define_iodesc_datatypes</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="memdesc:ac50e05927ec724b673ceb602b1c0d483"><td class="mdescLeft">&#160;</td><td class="mdescRight">If needed, create the derived MPI datatypes used for comp2io and io2comp transfers.  <a href="#ac50e05927ec724b673ceb602b1c0d483">More...</a><br/></td></tr>
<tr class="separator:ac50e05927ec724b673ceb602b1c0d483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a027a769a445dd9fc27635bc446a0e100"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a027a769a445dd9fc27635bc446a0e100">compute_counts</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc, const int *dest_ioproc, const PIO_Offset *dest_ioindex)</td></tr>
<tr class="memdesc:a027a769a445dd9fc27635bc446a0e100"><td class="mdescLeft">&#160;</td><td class="mdescRight">Completes the mapping for the box rearranger.  <a href="#a027a769a445dd9fc27635bc446a0e100">More...</a><br/></td></tr>
<tr class="separator:a027a769a445dd9fc27635bc446a0e100"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cf6663a5359e57a8e9afc9b9b25a3f3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a2cf6663a5359e57a8e9afc9b9b25a3f3">rearrange_comp2io</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc, void *sbuf, void *rbuf, int nvars)</td></tr>
<tr class="memdesc:a2cf6663a5359e57a8e9afc9b9b25a3f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Moves data from compute tasks to IO tasks.  <a href="#a2cf6663a5359e57a8e9afc9b9b25a3f3">More...</a><br/></td></tr>
<tr class="separator:a2cf6663a5359e57a8e9afc9b9b25a3f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae802d4ff09454d673bf4729e87e54d33"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#ae802d4ff09454d673bf4729e87e54d33">rearrange_io2comp</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc, void *sbuf, void *rbuf)</td></tr>
<tr class="memdesc:ae802d4ff09454d673bf4729e87e54d33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Moves data from IO tasks to compute tasks.  <a href="#ae802d4ff09454d673bf4729e87e54d33">More...</a><br/></td></tr>
<tr class="separator:ae802d4ff09454d673bf4729e87e54d33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fe0daa8651f1a1434907db2b05b9b1f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a4fe0daa8651f1a1434907db2b05b9b1f">determine_fill</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc, const int *gdimlen, const PIO_Offset *compmap)</td></tr>
<tr class="memdesc:a4fe0daa8651f1a1434907db2b05b9b1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine whether fill values are needed.  <a href="#a4fe0daa8651f1a1434907db2b05b9b1f">More...</a><br/></td></tr>
<tr class="separator:a4fe0daa8651f1a1434907db2b05b9b1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ca5039e5f9f85a449867af255ec6eee"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a0ca5039e5f9f85a449867af255ec6eee">box_rearrange_create</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, int maplen, const PIO_Offset *compmap, const int *gdimlen, int ndims, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="memdesc:a0ca5039e5f9f85a449867af255ec6eee"><td class="mdescLeft">&#160;</td><td class="mdescRight">The box rearranger computes a mapping between IO tasks and compute tasks such that the data on IO tasks can be written with a single call to the underlying netCDF library.  <a href="#a0ca5039e5f9f85a449867af255ec6eee">More...</a><br/></td></tr>
<tr class="separator:a0ca5039e5f9f85a449867af255ec6eee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5673bf80330c06b1c0de7ed597cd89dc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5673bf80330c06b1c0de7ed597cd89dc"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>box_rearrange_create_with_holes</b> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, int maplen, const PIO_Offset *compmap, const int *gdimlen, int ndims, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="separator:a5673bf80330c06b1c0de7ed597cd89dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab23cee4109e4fa8a752484456bbc62fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#ab23cee4109e4fa8a752484456bbc62fe">compare_offsets</a> (const void *a, const void *b)</td></tr>
<tr class="memdesc:ab23cee4109e4fa8a752484456bbc62fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare offsets is used by the sort in the subset rearranger.  <a href="#ab23cee4109e4fa8a752484456bbc62fe">More...</a><br/></td></tr>
<tr class="separator:ab23cee4109e4fa8a752484456bbc62fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee2d8bfcc4ad3d4be6daa7e536d30cb0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#aee2d8bfcc4ad3d4be6daa7e536d30cb0">get_regions</a> (int ndims, const int *gdimlen, int maplen, const PIO_Offset *map, int *maxregions, <a class="el" href="structio__region.html">io_region</a> *firstregion)</td></tr>
<tr class="memdesc:aee2d8bfcc4ad3d4be6daa7e536d30cb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate start and count regions for the subset rearranger.  <a href="#aee2d8bfcc4ad3d4be6daa7e536d30cb0">More...</a><br/></td></tr>
<tr class="separator:aee2d8bfcc4ad3d4be6daa7e536d30cb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f533cf3a08255228387fbd45f96c767"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a4f533cf3a08255228387fbd45f96c767">default_subset_partition</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="memdesc:a4f533cf3a08255228387fbd45f96c767"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the MPI communicators needed by the subset rearranger.  <a href="#a4f533cf3a08255228387fbd45f96c767">More...</a><br/></td></tr>
<tr class="separator:a4f533cf3a08255228387fbd45f96c767"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1398c48cfe642bff77891d07953a8659"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a1398c48cfe642bff77891d07953a8659">subset_rearrange_create</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, int maplen, PIO_Offset *compmap, const int *gdimlen, int ndims, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="memdesc:a1398c48cfe642bff77891d07953a8659"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the subset rearranger.  <a href="#a1398c48cfe642bff77891d07953a8659">More...</a><br/></td></tr>
<tr class="separator:a1398c48cfe642bff77891d07953a8659"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a459775627ccb163a9bcac77438004ba2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pio__rearrange_8c.html#a459775627ccb163a9bcac77438004ba2">performance_tune_rearranger</a> (<a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *ios, <a class="el" href="structio__desc__t.html">io_desc_t</a> *iodesc)</td></tr>
<tr class="memdesc:a459775627ccb163a9bcac77438004ba2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performance tuning rearranger.  <a href="#a459775627ccb163a9bcac77438004ba2">More...</a><br/></td></tr>
<tr class="separator:a459775627ccb163a9bcac77438004ba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Code to map IO to model decomposition. </p>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0ca5039e5f9f85a449867af255ec6eee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int box_rearrange_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maplen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>compmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The box rearranger computes a mapping between IO tasks and compute tasks such that the data on IO tasks can be written with a single call to the underlying netCDF library. </p>
<p>This may involve an all to all rearrangement in the mapping, but should minimize data movement in lower level libraries.</p>
<p>On each compute task the application program passes a compmap array of length ndof. This array describes the arrangement of data in memory on that compute task.</p>
<p>These arrays are gathered and rearranged to the IO-tasks (which are sometimes collocated with compute tasks), each IO task contains data from the compmap of one or more compute tasks in the iomap array and the length of that array is llen.</p>
<p>This function: </p>
<ul>
<li>
For IO tasks, determines llen. </li>
<li>
Determine whether fill values will be needed. </li>
<li>
Do an allgether of llen values into array iomaplen. </li>
<li>
For each IO task, send starts/counts to all compute tasks. </li>
<li>
Find dest_ioindex and dest_ioproc for each element in the map. </li>
<li>
Call <a class="el" href="pio__rearrange_8c.html#a027a769a445dd9fc27635bc446a0e100" title="Completes the mapping for the box rearranger. ">compute_counts()</a>. </li>
<li>
On IO tasks, compute the max IO buffer size. </li>
<li>
Call <a class="el" href="pio__darray__int_8c.html#a270978141a60afa6ab0aa99aff7cf715" title="Compute the maximum aggregate number of bytes. ">compute_maxaggregate_bytes()</a>. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">maplen</td><td>the length of the map. This is the number of data elements on the compute task. </td></tr>
    <tr><td class="paramname">compmap</td><td>a 1 based array of offsets into the global space. A 0 in this array indicates a value which should not be transfered. </td></tr>
    <tr><td class="paramname">gdimlen</td><td>an array length ndims with the sizes of the global dimensions. </td></tr>
    <tr><td class="paramname">ndims</td><td>the number of dimensions. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct, which must be allocated before this function is called. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="ab23cee4109e4fa8a752484456bbc62fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int compare_offsets </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compare offsets is used by the sort in the subset rearranger. </p>
<p>This function is passed to qsort.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>pointer to an offset. </td></tr>
    <tr><td class="paramname">b</td><td>pointer to another offset. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if offsets are the same or either pointer is NULL. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a027a769a445dd9fc27635bc446a0e100"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int compute_counts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>dest_ioproc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>dest_ioindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Completes the mapping for the box rearranger. </p>
<p>This function is called from <a class="el" href="pio__rearrange_8c.html#a0ca5039e5f9f85a449867af255ec6eee" title="The box rearranger computes a mapping between IO tasks and compute tasks such that the data on IO tas...">box_rearrange_create()</a>. It is not used for the subset rearranger.</p>
<p>This function: </p>
<ul>
<li>
Allocates and inits iodesc-&gt;scount, an array (length ios-&gt;num_iotasks) containing number of data elements sent to each IO task from current compute task. </li>
<li>
Uses <a class="el" href="pio__internal_8h.html#a4d341649c03cba93c667c26e4fb1ec9c" title="Provides the functionality of MPI_Alltoallw with flow control options. ">pio_swapm()</a> to send iodesc-&gt;scount array from each computation task to all IO tasks. </li>
<li>
On IO tasks, allocates and inits iodesc-&gt;rcount and iodesc-&gt;rfrom arrays (length max(1, nrecvs)) which holds the amount of data to expect from each compute task and the rank of that task. . </li>
<li>
Allocates and inits iodesc-&gt;sindex arrays (length iodesc-&gt;ndof) which holds indecies for computation tasks. </li>
<li>
On IO tasks, allocates and inits iodesc-&gt;rindex (length totalrecv) with indices of the data to be sent/received from this io task to each compute task. </li>
<li>
Uses <a class="el" href="pio__internal_8h.html#a4d341649c03cba93c667c26e4fb1ec9c" title="Provides the functionality of MPI_Alltoallw with flow control options. ">pio_swapm()</a> to send list of indicies on each compute task to the IO tasks. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">dest_ioproc</td><td>an array (length maplen) of IO task numbers. </td></tr>
    <tr><td class="paramname">dest_ioindex</td><td>an array (length maplen) of IO indicies. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a7be19ba8290fabfe5d713784109a13cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int compute_maxIObuffersize </td>
          <td>(</td>
          <td class="paramtype">MPI_Comm&#160;</td>
          <td class="paramname"><em>io_comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute the max io buffer size needed for an iodesc. </p>
<p>It is the combined size (in number of data elements) of all the regions of data stored in the buffer of this iodesc. The max size is then set in the iodesc.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_comm</td><td>the IO communicator </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 for success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a048b73236020ba121556fa86557a050d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PIO_Offset coord_to_lindex </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>lcoord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert a global coordinate value into a local array index. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>the number of dimensions. </td></tr>
    <tr><td class="paramname">lcoord</td><td>pointer to an offset. </td></tr>
    <tr><td class="paramname">count</td><td>array of counts. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the local array index. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a5c21c922692dea1b9f7a2a889b6e790c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_mpi_datatypes </td>
          <td>(</td>
          <td class="paramtype">MPI_Datatype&#160;</td>
          <td class="paramname"><em>mpitype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>msgcnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>mindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>mcount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>mfrom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MPI_Datatype *&#160;</td>
          <td class="paramname"><em>mtype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the derived MPI datatypes used for comp2io and io2comp transfers. </p>
<p>Used in <a class="el" href="pio__rearrange_8c.html#ac50e05927ec724b673ceb602b1c0d483" title="If needed, create the derived MPI datatypes used for comp2io and io2comp transfers. ">define_iodesc_datatypes()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mpitype</td><td>The MPI type of data (MPI_INT, etc.). </td></tr>
    <tr><td class="paramname">msgcnt</td><td>This is the number of MPI types that are created. </td></tr>
    <tr><td class="paramname">mindex</td><td>An array (length numinds) of indexes into the data array from the comp map. Will be NULL when count is zero. </td></tr>
    <tr><td class="paramname">mcount</td><td>An array (length msgcnt) with the number of indexes to be put on each mpi message/task. </td></tr>
    <tr><td class="paramname">mfrom</td><td>A pointer to the previous structure in the read/write list. This is always NULL for the BOX rearranger. </td></tr>
    <tr><td class="paramname">mtype</td><td>pointer to an array (length msgcnt) which gets the created datatypes. Will be NULL when iodesc-&gt;nrecvs == 0. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a4f533cf3a08255228387fbd45f96c767"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int default_subset_partition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the MPI communicators needed by the subset rearranger. </p>
<p>The subset rearranger needs a mapping from compute tasks to IO task, the only requirement is that each compute task map to one and only one IO task. This mapping groups by mpi task id others are possible and may be better for certain decompositions</p>
<p>The as yet unrealized vision here is that the user would be able to supply an alternative subset partitioning function. Requirements of this function are that there be exactly one io task per compute task group.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="ac50e05927ec724b673ceb602b1c0d483"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int define_iodesc_datatypes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If needed, create the derived MPI datatypes used for comp2io and io2comp transfers. </p>
<p>If iodesc-&gt;stype and iodesc-&gt;rtype arrays already exist, this function does nothing. This function is called from <a class="el" href="pio__rearrange_8c.html#ae802d4ff09454d673bf4729e87e54d33" title="Moves data from IO tasks to compute tasks. ">rearrange_io2comp()</a> and <a class="el" href="pio__rearrange_8c.html#a2cf6663a5359e57a8e9afc9b9b25a3f3" title="Moves data from compute tasks to IO tasks. ">rearrange_comp2io()</a>.</p>
<p>NOTE from Jim: I am always oriented toward write so recieve always means io tasks and send always means comp tasks. The opposite relationship is actually the case for reading. I've played with different ways of referring to things to get rid of this orientation bias in the documentation as well as in variable names, but I haven't found anything that I found more satisfactory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a4fe0daa8651f1a1434907db2b05b9b1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int determine_fill </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>compmap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determine whether fill values are needed. </p>
<p>This function compares how much data we have to how much data is in a record (or non-record var). If we have enough data to completely fill the variable, then fill is not needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">gdimlen</td><td>pointer to an array length iodesc-&gt;ndims with the global array sizes for one record (for record vars) or for the entire var (for non-record vars). </td></tr>
    <tr><td class="paramname">compmap</td><td>only used for the box communicator. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a34894ab4fab60701301c8d3c67219c20"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void expand_region </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maplen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>region_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>region_stride</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>max_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO_Offset *&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Expand a region along dimension dim, by incrementing count[i] as much as possible, consistent with the map. </p>
<p>Once max_size is reached, the map is exhausted, or the next entries fail to match, expand_region updates the count and calls itself with the next outermost dimension, until the region has been expanded as much as possible along all dimensions.</p>
<p>Precondition: maplen &gt;= region_size (thus loop runs at least once).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dim</td><td>the dimension number to start with. </td></tr>
    <tr><td class="paramname">gdimlen</td><td>array of global dimension lengths. </td></tr>
    <tr><td class="paramname">maplen</td><td>the length of the map. </td></tr>
    <tr><td class="paramname">map</td><td>array (length maplen) with the the 1-based compmap. </td></tr>
    <tr><td class="paramname">region_size</td><td>??? </td></tr>
    <tr><td class="paramname">region_stride</td><td>amount incremented along dimension. </td></tr>
    <tr><td class="paramname">max_size</td><td>array of size dim + 1 that contains the maximum sizes along that dimension. </td></tr>
    <tr><td class="paramname">count</td><td>array of size dim + 1 that gets the new counts. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a1618d520a976b72b2e617794e67a0a96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PIO_Offset find_region </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maplen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO_Offset *&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO_Offset *&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set start and count so that they describe the first region in map. </p>
<p>This function is used when creating the subset rearranger (it is not used for the box rearranger). It is called by <a class="el" href="pio__rearrange_8c.html#aee2d8bfcc4ad3d4be6daa7e536d30cb0" title="Calculate start and count regions for the subset rearranger. ">get_regions()</a>.</p>
<p>Preconditions: </p>
<ul>
<li>
ndims is &gt; 0 </li>
<li>
maplen is &gt; 0 </li>
<li>
All elements of map are inside the bounds specified by gdimlen. </li>
</ul>
<p>Note that the map array is 1 based, but calculations are 0 based.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>the number of dimensions. </td></tr>
    <tr><td class="paramname">gdimlen</td><td>an array length ndims with the sizes of the global dimensions. </td></tr>
    <tr><td class="paramname">maplen</td><td>the length of the map. </td></tr>
    <tr><td class="paramname">map</td><td></td></tr>
    <tr><td class="paramname">start</td><td>array (length ndims) that will get start indicies of found region. </td></tr>
    <tr><td class="paramname">count</td><td>array (length ndims) that will get counts of found region. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>length of the region found. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="aee2d8bfcc4ad3d4be6daa7e536d30cb0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_regions </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maplen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const PIO_Offset *&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>maxregions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__region.html">io_region</a> *&#160;</td>
          <td class="paramname"><em>firstregion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate start and count regions for the subset rearranger. </p>
<p>This function is not used in the box rearranger.</p>
<p>Each region is a block of output which can be represented in a single call to the underlying netcdf library. This can be as small as a single data point, but we hope we've aggragated better than that.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>the number of dimensions </td></tr>
    <tr><td class="paramname">gdimlen</td><td>an array length ndims with the sizes of the global dimensions. </td></tr>
    <tr><td class="paramname">maplen</td><td>the length of the map </td></tr>
    <tr><td class="paramname">map</td><td>may be NULL (when ???). </td></tr>
    <tr><td class="paramname">maxregions</td><td></td></tr>
    <tr><td class="paramname">firstregion</td><td>pointer to the first region. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a26b1b0f5f1f4f977aa5e9d9d0fb09ce1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void idx_to_dim_list </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO_Offset&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO_Offset *&#160;</td>
          <td class="paramname"><em>dim_list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert a 1-D index into a coordinate value in an arbitrary dimension space. </p>
<p>E.g., for index 4 into a array defined as a[3][2], will return 2,0.</p>
<p>Sometimes (from box_rearranger_create()) this function is called with -1 for idx. Not clear if this makes sense.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>number of dimensions. </td></tr>
    <tr><td class="paramname">gdimlen</td><td>array of length ndims with the dimension sizes. </td></tr>
    <tr><td class="paramname">idx</td><td>the index to convert. This is the index into a 1-D array of data. </td></tr>
    <tr><td class="paramname">dim_list</td><td>array of length ndims that will get the dimensions corresponding to this index. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards, Ed Hartnett </dd></dl>

</div>
</div>
<a class="anchor" id="aae7757932984cb74424b447b9cf4955e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_rearr_opts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iosys</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Internal library util function to initialize rearranger options. </p>
<p>This is used in <a class="el" href="group___p_i_o__init.html#ga479a1d9fe2edfc7ca321a1b482fe0211" title="Library initialization used when IO tasks are a subset of compute tasks. ">PIOc_Init_Intracomm()</a>.</p>
<p>NOTE: The old default for max pending requests was 64 - we no longer use it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iosys</td><td>pointer to iosystem descriptor </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a459775627ccb163a9bcac77438004ba2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void performance_tune_rearranger </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performance tuning rearranger. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the iosystem description struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>pointer to the IO description struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a2cf6663a5359e57a8e9afc9b9b25a3f3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rearrange_comp2io </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>sbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>rbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Moves data from compute tasks to IO tasks. </p>
<p>This is called from <a class="el" href="pio_8h.html#a8e6611243431101939c4dd4c991a7e0b" title="Write one or more arrays with the same IO decomposition to the file. ">PIOc_write_darray_multi()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">sbuf</td><td>send buffer. May be NULL. </td></tr>
    <tr><td class="paramname">rbuf</td><td>receive buffer. May be NULL. </td></tr>
    <tr><td class="paramname">nvars</td><td>number of variables. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="ae802d4ff09454d673bf4729e87e54d33"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rearrange_io2comp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>sbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>rbuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Moves data from IO tasks to compute tasks. </p>
<p>This function is used in <a class="el" href="pio_8h.html#aa4eb9375a17ec358a88c8e7e388880db" title="Read a field from a file to the IO library. ">PIOc_read_darray()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">sbuf</td><td>send buffer. </td></tr>
    <tr><td class="paramname">rbuf</td><td>receive buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
<a class="anchor" id="a1398c48cfe642bff77891d07953a8659"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int subset_rearrange_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiosystem__desc__t.html">iosystem_desc_t</a> *&#160;</td>
          <td class="paramname"><em>ios</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maplen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO_Offset *&#160;</td>
          <td class="paramname"><em>compmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>gdimlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structio__desc__t.html">io_desc_t</a> *&#160;</td>
          <td class="paramname"><em>iodesc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the subset rearranger. </p>
<p>The subset rearranger computes a mapping between IO tasks and compute tasks such that each compute task communicates with one and only one IO task.</p>
<p>This function is called from <a class="el" href="group___p_i_o__initdecomp.html#ga56c119d47d1082df044968f80acbe265" title="Initialize the decomposition used with distributed arrays. ">PIOc_InitDecomp()</a>.</p>
<p>This function: </p>
<ul>
<li>
Calls <a class="el" href="pio__rearrange_8c.html#a4f533cf3a08255228387fbd45f96c767" title="Create the MPI communicators needed by the subset rearranger. ">default_subset_partition()</a> to create subset_comm. </li>
<li>
For IO tasks, allocates iodesc-&gt;rcount array (length ntasks). </li>
<li>
Allocates iodesc-&gt;scount array (length 1) </li>
<li>
Determins value of iodesc-&gt;scount[0], the number of data elements on this compute task which are read/written. </li>
<li>
Allocated and inits iodesc-&gt;sindex (length iodesc-&gt;scount[0]), init it to contain indicies to data. </li>
<li>
Pass the reduced maplen (without holes) from each compute task to its associated IO task. </li>
<li>
On IO tasks, determine llen. </li>
<li>
Determine whether fill values will be needed. </li>
<li>
Pass iodesc-&gt;sindex from each compute task to its associated IO task. </li>
<li>
Create shrtmap, which is compmap without the holes. </li>
<li>
Gather shrtmaps from each task into iomap. </li>
<li>
On IO tasks, sort the mapping, this will transpose the data into IO order. </li>
<li>
On IO tasks, allocate and init iodesc-&gt;rindex and iodesc-&gt;rfrom (length iodesc-&gt;llen). </li>
<li>
On IO tasks, handle fill values, if needed. </li>
<li>
On IO tasks, scatter values of srcindex to subset communicator. </li>
<li>
On IO tasks, call <a class="el" href="pio__rearrange_8c.html#aee2d8bfcc4ad3d4be6daa7e536d30cb0" title="Calculate start and count regions for the subset rearranger. ">get_regions()</a> and distribute the max maxregions to all tasks in IO communicator. </li>
<li>
On IO tasks, call <a class="el" href="pio__rearrange_8c.html#a7be19ba8290fabfe5d713784109a13cc" title="Compute the max io buffer size needed for an iodesc. ">compute_maxIObuffersize()</a>. </li>
<li>
Call <a class="el" href="pio__darray__int_8c.html#a270978141a60afa6ab0aa99aff7cf715" title="Compute the maximum aggregate number of bytes. ">compute_maxaggregate_bytes()</a>. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ios</td><td>pointer to the <a class="el" href="structiosystem__desc__t.html" title="IO system descriptor structure. ">iosystem_desc_t</a> struct. </td></tr>
    <tr><td class="paramname">maplen</td><td>the length of the map. </td></tr>
    <tr><td class="paramname">compmap</td><td>a 1 based array of offsets into the array record on file. A 0 in this array indicates a value which should not be transfered. </td></tr>
    <tr><td class="paramname">gdimlen</td><td>an array length ndims with the sizes of the global dimensions. </td></tr>
    <tr><td class="paramname">ndims</td><td>the number of dimensions. </td></tr>
    <tr><td class="paramname">iodesc</td><td>a pointer to the <a class="el" href="structio__desc__t.html" title="IO descriptor structure. ">io_desc_t</a> struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, error code otherwise. </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jim Edwards </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 22 2019 11:11:12 for PIO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
